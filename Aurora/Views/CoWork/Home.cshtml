
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var iconarray = new List<string>();
    iconarray.Add("glyphicon-star");
    iconarray.Add("glyphicon-th-list");
    iconarray.Add("glyphicon-blackboard");
    var idx = 0;
}

    <script src="../../ckeditor/ckeditor.js"></script>
    <script src="~/Scripts/Aurora.js" type="text/javascript"></script>

    <script type="text/javascript">
    $(function(){
        Aurora.mainpageinit();
    })
    </script>


    <div style='height:28px;width:28px;border-radius: 5px;position:fixed;top:68px;right:30px;z-index:1009; border: 1px dashed grey; border-image: none;text-align:center;cursor:pointer;' data-toggle="tooltip" data-placement="center" title="Create New Topic" onclick="createnewtopic()">
        <span class="glyphicon glyphicon-plus" style="color:grey;font-size:24px;"></span>
        <script type="text/javascript">
        function createnewtopic() {
            window.location.href = '/CoWork/CreateNewTopic'
        }
        </script>
    </div>


    <div class="newcontainer">
        <hr style="color:grey;margin-top:1px;margin-bottom:1px;border: 1px solid;border-color:grey" />

        <nav class="col-sm-2 nav-sidebar">
            <ul class="nav">
                <li class="cursor-pointer nav-sidebar-icon">
                    <span class="glyphicon glyphicon-menu-hamburger sidebar-show"></span>
                </li>
                @foreach (var item in ViewBag.NavList)
                {
                    var navactive = "";
                    if (string.Compare(item, ViewBag.ActiveNav) == 0)
                    {
                        navactive = "activenavitem active";
                    }
                    <li class="@(navactive)" navid="@item">
                        <a href="/CoWork/Home?activenavitem=@item">
                            <span class="glyphicon @(iconarray[idx%3])" data-toggle="tooltip" title="@item"></span>
                            <span class="item-show">@item</span>
                        </a>
                    </li>
                    idx = idx + 1;
                }
            </ul>
        </nav>

        <div class="col-sm-3 item-panels" style="padding-left:8px;padding-right:8px;">
            @foreach (var item in ViewBag.topiclist)
                {
                    var pjworklistcount = item.ProjectWorkingList.Count;
                    var pjdonelistcount = item.ProjectDoneList.Count;
                    var totalpjcount = pjworklistcount + pjdonelistcount;
                    var itempanel = "item-panel";
                    if (string.Compare(item.topicid, ViewBag.ActiveTopicid) == 0)
                    {
                        itempanel = "item-panel-active";
                    }

                    <div class="@(itempanel)">
                        <div class="item-title">
                            <div class="item-name">@item.creator</div>
                            <div class="item-op dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    <span class="glyphicon glyphicon-option-vertical" title="Operations" data-toggle="tooltip"></span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="#">Delete</a>
                                    </li>
                                    <li>
                                        <a href="#">Complete</a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="item-content  topiclistcls" topicid="@item.topicid">
                            <div class="item-date">@item.duedate</div>
                            @if (totalpjcount > 0)
                            {
                                <div class="progress item-progress">
                                    @foreach (var pj in item.ProjectDoneList)
                                    {
                                        <div class="progress-bar progress-bar-complete" style="width: @(1.0/totalpjcount*100)%">
                                            <span class="sr-only">Complete</span>
                                        </div>
                                    }
                                    @foreach (var pj in item.ProjectWorkingList)
                                    {
                                        <div class="progress-bar progress-bar-working" style="width: @(1.0/totalpjcount*100)%">
                                            <span class="sr-only">Working</span>
                                        </div>
                                    }
                                </div>
                            }
                        </div>

                        <div class="item-content  topiclistcls" topicid="@item.topicid">
                            <div>
                                @item.subject
                            </div>
                        </div>
                    </div>
            }

            <div class='itemlistswitchclose'>
                <span class='glyphicon glyphicon-menu-left' style='margin-top:13px;'></span>
            </div>
        </div>
        <div class="col-sm-7 item-details-show">
            @if (ViewBag.CurrentTopic != null)
                {
                    var crttopic = ViewBag.CurrentTopic[0];
                <input class="hide" id="currenttopicid" name="currenttopicid" value="@(crttopic.topicid)" />

                    <div class="itemdetailinfo">
                        <div class="topicinfo">
                            <div class="topictitle">
                                <div class="titlesubject">@(crttopic.subject)</div>
                                <div class="topictitlemenu">
                                    <span class="glyphicon glyphicon-pencil home-md-topic" data-toggle="tooltip" title="modify topic" style="height:25px;width:25px;margin-right:10px"></span>
                                    <span class="glyphicon glyphicon-tasks home-proj" data-toggle="tooltip" title="set task status" style="height:25px;width:25px;margin-right:10px"></span>
                                </div>
                            </div>
                            <div class="topiccontent">
                                @Html.Raw(crttopic.topiccontent)
                            </div>
                            <div class="topicfooter">
                                <span>@(crttopic.creator)</span>
                                <span>@(crttopic.createdate)</span>
                            </div>
                        </div>
                    </div>

                using (Html.BeginForm("NewTopicComment", "CoWork", FormMethod.Post, new { enctype = "multipart/form-data", id = "commentform", name = "commentform" }))
                {
                    <div class="panel panel-success br-panel">
                        <div class="panel-heading cursor-pointer br-panel-heading" role="tab" id="headingTwo">
                            <h4 class="panel-title br-panel-title" data-toggle="collapse" data-target="#c_comment" aria-expanded="true">
                                <span class="title-box">Comment</span>
                                <span class="glyphicon glyphicon-chevron-down chevron-down"></span>
                            </h4>
                        </div>
                        <div id="c_comment" class="panel-collapse collapse" role="tabpanel">
                            <div class="panel-body">
                                <div class="row">
                                    <textarea name="CommentEditor" id="CommentEditor" rows="10" cols="80"></textarea>
                                    <script>
                                        CKEDITOR.replace('CommentEditor', { htmlEncodeOutput: true, skin: 'moono-lisa' });
                                    </script>
                                </div>
                                <div class="row" style="padding:15px;text-align:left;">
                                    <span class="btn btn-default btn-file" id="choosefile2">
                                        Editor Attachment <input class="btn-available" type="file" name="file1" id="file1" runat="server" onchange="ShowFileNamex(this)" />
                                    </span>
                                    <input class="btn btn-success" type="button" value="Submit" onclick="CommitComment()">
                                    <input class="hide" id="activenav" name="activenav" type="text" value="">
                                    <input class="hide" id="activetopicid" name="activetopicid" value="@(crttopic.topicid)" type="text">
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            function ShowFileNamex(oFile) {
                                        ajaxFileUploadx();
                                    }
                            function ajaxFileUploadx() {
                                $.ajaxFileUpload
                                (
                                    {
                                        url: '/userfiles/ImageUpload.ashx',
                                        secureuri: false,
                                        fileElementId: 'file1',
                                        dataType: 'HTML',
                                        success: function (data, status)
                                        {
                                            var wholeval = CKEDITOR.instances.CommentEditor.getData() + data;
                                            CKEDITOR.instances.CommentEditor.setData(wholeval);
                                        },
                                        error: function (e)
                                        {
                                            alert(e);
                                        }
                                    }
                                )
                                return false;
                            }
                            function CommitComment()
                            {
                                $('#activenav').val($('.activenavitem').attr("navid"));
                                $('#commentform').submit();
                            }
                        </script>
                    </div>
                }

                foreach (var citem in crttopic.CommentList)
                {
                    <div class="commentinfo">
                        <div class="commenthead">
                            <div class="commenttitle">
                                <span>@(citem.creator)</span>
                                <span>@(citem.commentdate)</span>
                            </div>
                            <div class="commentop">
                                <span class="glyphicon glyphicon-pencil home-md-commont" cid="@(citem.commentid)" data-toggle="tooltip" title="modify topic"></span>
                                @*<span class="glyphicon glyphicon-trash commentopitem"></span>*@
                            </div>
                        </div>
                        <div class="commentcontent">
                            @Html.Raw(citem.commentcontent)
                        </div>
                    </div>
                }

            }


            <div class='itemlistswitchopen hide'>
                <span class='glyphicon glyphicon-menu-right' style='margin-top:13px;'></span>
            </div>
        </div>

    </div>

